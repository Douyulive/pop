<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="lvlanxing" name="author">
<title>斗鱼粉丝牌</title>
<link rel="shortcut icon" href="https://rawcdn.githack.com/popzoo/pop/9d4121eed5cbb035e55203b8a9e56a73dcf2e6bf/images/favicon.ico"> 
<meta content="粉丝牌,斗鱼粉丝牌,牌子,粉丝牌大全，斗鱼粉丝牌大全" name="Keywords">
<link rel="stylesheet" href="css/pop_page.css">
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");document.write(unescape("%3Cspan style='display:none;' id='cnzz_stat_icon_1278032070'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/z_stat.php%3Fid%3D1278032070%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
</head>
<body>
<div style=" height:30px; color:#3C3C3C; line-height:30px; margin:0 0 -30px -130px; padding:20px 0 0 50%; font-size:30px; font-family: Arial,Microsoft YaHei,'宋体';">
    💝RUN_DYNAMIC_GIFT_DATA💝
    <span class="collapse" style="float: right;white-space: nowrap; margin-right: 60px; font-size: 20px;color:#4D4D4D;"> 
        <a class="nav-link" style="text-decoration:none;" href="https://popzoo.github.io/zoo/">时光轴</a> •
        <a class="nav-link" style="text-decoration:none;" href="https://popzoo.github.io/barrage/">云弹幕</a> •
        <a class="nav-link" style="text-decoration:none;" href="https://popzoo.github.io/pop/giftshow.html">礼物秀</a> •
        <a class="nav-link" style="text-decoration:none;" href="https://popzoo.github.io/pop/motorcade.html">车队展</a> •
        <a class="nav-link" style="text-decoration:none;" href="https://greasyfork.org/zh-CN/scripts/389379">GreaseFork</a>
    </span>
</div>
<div class="content">
  <div id="device" class="gridalicious">
    <div class="galcolumn">
<!--    <div class="item"><img src="images/1.jpg" alt="响应式瀑布流布局插件"/><p>JS代码网</p></div>  -->
    </div>
  </div>
</div>
<div id="rocket-to-top">
  <div style="opacity: 0; display: block;" class="level-2"></div>
  <div class="level-3"></div>
</div>
    <!-- loading按钮自己通过样式调整 -->
<footer id="loading" style="width:370px;height:30px;line-height:30px;font-size:18px;text-align:center;border-radius:3px;opacity:0.8;background:#BBBBBB;margin:10px auto 30px;color:black;">
    加载中...
</footer>
<!-- <script src="js/jquery-1.8.3.min.js"></script> -->
<script src="https://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="js/jquery.grid-a-licious.min.js"></script>
<script src="js/spider-background.js"></script> <!-- 蛛网背景图 -->
<script src="js/rocket.js"></script>
<script type="text/javascript">
    var num = 0;
    var giftList = new Array();
    var numList = JSON.parse(localStorage.getItem("DynamicGiftNum💡🌄💡"));
    // var count = 0;
    getDyanmicGift();
    function getDyanmicGift(){//todo:==================================这个json需要提速
        fetch('https://cdn.statically.io/gh/popzoo/pop/master/json/dynamic_gift.json',{
            method: 'GET',
            mode: 'cors', //请求模式为跨域
            cache: 'default', //no-cache
            credentials: 'omit', // 同源则加入凭据头,omit,include
        }).then(res => {
            return res.text();
        }).then(result => {
            let arrList = JSON.parse(result);
            for(let i=arrList.length-1;i>=0;i--){
                let jsonData = {"id":arrList[i].id,"name":arrList[i].name,"himg":arrList[i].himg,"exp":arrList[i].exp,"hit_interval":arrList[i].hit_interval,"price_name":arrList[i].price_name,"stay_time":arrList[i].stay_time,"intro":arrList[i].intro};
                giftList.push(jsonData);
            }
            console.info("动态礼物总数:"+giftList.length);

            saveJsonContent(JSON.stringify(giftList),'dynamic_gift.json');
            // $("#device").gridalicious('append', makeboxes());
        }).catch(err => {
            console.error('请求错误', err);
        })        
    }
    // callbackGift();
    function crawlerDynamicGift(code){
        // const res =$.ajax({
        $.ajax({
            async : true,
            url : "https://webconf.douyucdn.cn/resource/common/gift/gift_template/"+ code +".json",//1~800 20000~20339 这里要爬
            type : "GET",
            dataType : "jsonp", // 返回的数据类型，设置为JSONP方式
            jsonp : 'callback', //指定一个查询参数名称来覆盖默认的 jsonp 回调参数名 callback
            jsonpCallback: 'DYConfigCallback', //设置回调函数名
            success: function(response, status, xhr){
                if(status == "success"){
                    console.info("有效礼物模板号："+ code);
                    let jsonData=response.data;
                    giftList = mergeRemoveBoth(giftList,response.data);
                    // numList.push(num);
                }
            },
            error:function(XMLHttpRequest, textStatus, errorThrown){
                console.error("失败");
            }
        });
    }

    function mergeRemoveBoth(arr1,arr2){ //不要直接使用var arr = arr1，这样arr只是arr1的一个引用，两者的修改会互相影响
        var arr = arr1.concat();//或者使用slice()复制，var arr = arr1.slice(0)
        for(var i=0;i<arr2.length;i++){
            arr.indexOf(arr2[i]) === -1 ? arr.push(arr2[i]) : 0;
        }
        return arr;
    }

    // function callbackGift(){
    //     if(num<=30000){//<=20339 这里可以爬
    //         crawlerDynamicGift();
    //         setTimeout(callbackGift,200);
    //         num++;
    //     }else{
    //         console.info("动态礼物爬取完毕");
    //         // localStorage.setItem("DynamicGiftNum💡🌄💡",JSON.stringify(numList));
    //         localStorage.setItem("GiftData💡🌄💡",JSON.stringify(giftList));
    //         saveJsonContent(JSON.stringify(giftList),'dynamic_gift.json');
    //     }
    // }

    function callbackGift(){
        if(num<=numList.length){
            crawlerDynamicGift(numList[num]);
            setTimeout(callbackGift,200);
            num++;
        }else{
            console.info("动态礼物爬取完毕");
            localStorage.setItem("GiftData💡🌄💡",JSON.stringify(giftList));
            saveJsonContent(JSON.stringify(giftList),'dynamic_gift.json');
        }
    }

    function saveJsonContent (content, fileName) {
        let downLink = document.createElement('a')
        downLink.download = fileName;
        let blob = new Blob([content]);//字符内容转换为blod地址
        downLink.href = URL.createObjectURL(blob);
        document.body.appendChild(downLink);// 链接插入到页面
        downLink.click();
        document.body.removeChild(downLink);// 移除下载链接
    }         

    </script>
</body>
</html>